
How to build Dokan library


** Build Envrionment

You need WDK(Windows Driver Kit). You can get WDK through Microsoft Connect Web site for free.
http://www.microsoft.com/whdc/DevTools/WDK/WDKpkg.mspx
https://connect.microsoft.com


** Build

When you unzip the dokan source codes, you can get the following folders.

    * \dokan (user-mode library dokan.dll)
    * \dokan_control (control program dokanctl.exe)
    * \dokan_mirror (sample program)
    * \dokan_mount (mount service mounter.exe)
    * \sys (driver dokan.sys) 

After installing WDK, launch the build environment from the Start menu. Change the directory to dokan source code.
Run Ågbuild /wcbgÅh command within each folders.


** Install Driver

Now you can get binary programs for example under Åg\dokan\objchk_wlh_x86\i386Åç.
You need dokan.dll dokan.sys dokanctl.exe mounter.exe mirror.exe

Copy dokan.sys under \Windows\system32\drivers
Copy dokan.dll under \Windows\system32
Place dokanctl.exe and mounter.exe in the same folder.

Run Ågdokanctl.exe /i aÅh This means register the driver and the service to Windows.
You can also do them separately.
Ågdokanctl.exe /i dÅh Install driver.
Ågdokanctl.exe /i sÅh install service.

If you update your driver, you MUST restart your computer after uninstalling previous version.


** Test the driver

You can get version information when you run Ågdokanctl.exe /vÅh.


** Sample program

Run Ågmirror.exe /r c:\ /l mÅh. This means mirror C driver under M driver. Can you see M driver?
To unmount M driver, run Ågdokanctl.exe /u mÅh
You can see all options of mirror.exe by running mirror.exe without argument.


** Uninstall Driver

Ågdokanctl.exe /r aÅh Uninstall both driver and service.
Ågdokanctl.exe /r dÅh Uninstall driver.
Ågdokanctl.exe /r sÅh Uninstall service.
You should restart your computer after uninstalling driver.


** For Windows Vista x64

You are required a code signing certification to install driver on Windows Vista x64.
You can disable driver signature enforcement using ReadyDriver Plus.
http://www.citadelindustries.net/readydriverplus/


** Windbg

You can debug the driver with Windbg. http://www.microsoft.com/whdc/Devtools/Debugging/default.mspx
You need to turn debug mode on. http://www.microsoft.com/whdc/driver/tips/Debug_Vista.mspx

